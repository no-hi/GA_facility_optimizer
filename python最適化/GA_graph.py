import os
import matplotlib.pyplot as plt
import numpy as np

import matplotlib
matplotlib.rcParams['font.family'] = 'TakaoPGothic' # takao インストール後、matplotlibのフォルダ行ってキャッシュ削除
import datetime
current_time = datetime.datetime.now().strftime('%Y%m%d_%H%M%S')

##############################################################################

# inc(1~20)+trans(0~8)コスト行列
foldername = "kanen1000"
cost = [[[10279566.592899997, 0, 329899.8818864615, 138135.64307217477, 0, 0], [7383099.307499996, 0, 342285.3404406706, 164599.8166212692, 0, 0], [4743483.470700002, 0, 355771.4966967819, 205841.14094314096, 0, 0], [3397626.948399999, 0, 369920.74918130506, 249747.23673534326, 0, 0], [2775700.8738999995, 0, 384110.53616400325, 307426.8108801027, 0, 0], [2154975.7925000004, 0, 397615.02799237816, 345332.6310899478, 0, 0], [1702368.0604000005, 0, 407908.6272932413, 382365.82904059737, 0, 0], [1428314.7158000006, 0, 419535.5491641308, 426230.7243763468, 0, 0], [1235528.6735, 0, 425265.47976063576, 444009.4085321045, 0, 0], [1115466.7463999994, 0, 435535.9276399808, 477340.97752355796, 0, 0], [1022407.9169999993, 0, 441566.56031747465, 495310.73816972476, 0, 0], [923109.2559999992, 0, 451322.6748999898, 528485.2937329033, 0, 0], [864578.2276999992, 0, 456272.8011518044, 542425.4444035833, 0, 0], [780553.3949999996, 0, 466189.5999419623, 575619.2748317416, 0, 0], [720217.2204999995, 0, 473075.9324879429, 595642.7300800983, 0, 0], [654221.0308999997, 0, 480215.1631583947, 618887.6993669147, 0, 0], [615559.9777999995, 0, 483086.3524194024, 625630.6373118829, 0, 0], [602042.1458999994, 0, 482330.0255953278, 618393.3212587481, 0, 0], [540107.3113000002, 0, 490828.6974408878, 645273.5897444595, 0, 0], [503286.7259000001, 0, 497084.6780547623, 663950.39058814, 0, 0]], [[7574636.006900001, 662050.60606, 329899.8818864615, 138135.64307217477, 7653.720155424562, 538239.5382205871], [4565226.451099999, 662050.60606, 342047.53477158566, 162512.92984408402, 7653.720155424562, 538239.5382205871], [2994257.4976999997, 709443.8524799999, 356077.1960905506, 208531.12068446877, 9157.138272498982, 657227.9855682707], [2788673.4361, 209898.96604000003, 369907.01664463663, 249805.53814451626, 4414.037998784197, 289647.5682804241], [2094787.8004, 212684.25739999994, 383562.73598675954, 288418.8254328009, 5451.628113271557, 367555.4068322478], [1602792.0350000001, 210337.12130000006, 397689.6605675343, 345757.0228505315, 3783.7061562212066, 242907.23959427365], [1490395.4360000007, 64865.85155999999, 407908.6272932413, 382365.82904059737, 1080.0929011382304, 56650.20791385303], [1216342.0914, 64865.85155999999, 419535.5491641308, 426230.7243763468, 1080.0929011382304, 56650.20791385303], [1159465.9699, 27498.4122, 425265.47976063576, 444009.4085321045, 828.067497114981, 42473.378914480716], [1039404.0427999992, 27498.4122, 435535.9276399808, 477340.97752355796, 828.067497114981, 42473.378914480716], [940105.3817999992, 27498.4122, 445292.04222249595, 510515.5330867365, 828.067497114981, 42473.378914480716], [882014.4012999991, 12663.377860000002, 451377.8739935964, 528697.6929577045, 602.4355823103707, 29022.574439341097], [798384.1850999994, 12663.377860000002, 461245.9693555547, 561709.9802941043, 602.4355823103707, 29022.574439341097], [735890.2774999997, 12663.377860000002, 466148.32696579833, 575473.5375456593, 602.4355823103707, 29022.574439341097], [685993.4110999997, 12663.377860000002, 470527.6883120641, 587784.2289987016, 602.4355823103707, 29022.574439341097], [609163.2968999998, 12663.377860000002, 480221.3269769828, 618916.8075769357, 602.4355823103707, 29022.574439341097], [578888.4610999997, 12663.377860000002, 483278.64521403465, 626280.6538056458, 602.4355823103707, 29022.574439341097], [540981.0883, 12663.377860000002, 487073.799390681, 635912.4258924936, 602.4355823103707, 29022.574439341097], [540107.3113000002, 0, 490828.6974408878, 645273.5897444595, 0, 0], [498505.98380000016, 0, 497205.03209339606, 664396.33417152, 0, 0]], [[3154158.9856000007, 2838876.104739999, 329899.8818864615, 138135.64307217477, 20781.560578464185, 1518428.073814204], [2884240.374499999, 1371494.4585399998, 342353.2341653544, 165202.90958541186, 16810.858427923544, 1195467.5237888577], [2994257.4976999997, 553994.43258, 356077.1960905506, 208531.12068446877, 9548.6836645286, 658628.0012300863], [2061457.1218999997, 529661.24434, 369688.0219678485, 248357.30131482126, 9190.188993185873, 606923.2577494775], [1543613.8939, 421087.6511200001, 383348.4548067998, 287140.8715468323, 9224.121428386916, 609752.728926501], [1390819.4106000003, 275202.97286000004, 397689.6605675343, 345757.0228505315, 4863.799057359437, 299557.4475081267], [1485886.3253000006, 49830.988840000005, 407869.83375901624, 382176.3652643907, 1224.5422551898528, 60875.32282223815], [1213981.6775, 50262.90488, 419516.98291606875, 426140.02854317724, 1207.9606596082153, 59462.380758426385], [1093724.6112, 42713.710880000006, 425265.47976063576, 444009.4085321045, 1680.9459805985487, 85670.60194523649], [973662.6840999993, 42713.710880000006, 435535.9276399808, 477340.97752355796, 1680.9459805985487, 85670.60194523649], [874364.0230999992, 42713.710880000006, 445292.04222249595, 510515.5330867365, 1680.9459805985487, 85670.60194523649], [879452.6650999993, 12567.728620000002, 451338.350774664, 528560.9281939599, 650.8249947008903, 31128.484405602525], [782458.9256999993, 20075.691460000002, 456280.23160384, 542461.2502092596, 1221.0912480359125, 58755.69958228005], [709433.0919999996, 24861.1084, 466246.51732289983, 575948.437491125, 932.591845611425, 43172.75009216698], [683814.6631999997, 12663.377860000002, 470527.6883120641, 587784.2289987016, 602.4355823103707, 29022.574439341097], [594206.9604999996, 26968.6845, 478272.0491025062, 611382.2702745075, 974.162154253552, 45998.282887582056], [552367.9094999998, 24861.1084, 482778.3652947129, 624043.6120688351, 932.591845611425, 43172.75009216698], [547188.5577, 12663.377860000002, 487260.0630053455, 636534.1079483434, 602.4355823103707, 29022.574439341097], [531956.9880000001, 3207.3613, 490916.6317557136, 645544.6133893713, 136.71334064252838, 5651.208401136365], [484894.15990000014, 3634.76688, 497196.5339602141, 664370.6026900247, 280.7869853249674, 12006.004115315029]], [[3127468.6710000006, 2345206.64882, 329899.8818864615, 138135.64307217477, 21888.36109334105, 1530448.8810467725], [2621939.7794, 1425109.36774, 335345.2808786233, 138135.64307217475, 18857.458971088032, 1295316.7176210987], [1776993.6106, 1105898.8430599999, 355887.2418240974, 206852.25665217682, 18326.173393277342, 1261318.04496584], [1452503.6096, 739560.2103800002, 369674.28943118, 248415.60272399426, 13604.22699197007, 896570.8260299016], [1331641.2695000002, 485953.5026800001, 383348.4548067998, 287140.8715468323, 10304.214329525148, 666402.936840354], [1385136.8574000003, 244377.60114000004, 397594.6431366191, 345228.4353319955, 5176.330132324873, 303088.33650306833], [1409823.6217000005, 77329.40104000001, 407869.83375901624, 382176.3652643907, 2052.609752304834, 103348.70173671887], [1173425.0614, 59104.73354, 419543.5944527845, 426270.03694527305, 1782.88280920292, 87772.99736846305], [1015708.3499999994, 77329.40104000001, 429767.2035092509, 459372.8295915935, 2052.609752304834, 103348.70173671887], [977697.8596999993, 43401.07252, 435535.9276399808, 477340.97752355796, 1679.2500942084248, 83525.23664178458], [962579.6700999995, 17524.70702, 441381.9770783127, 494600.194560274, 900.0766482114549, 41736.878605257705], [849029.6325999993, 20619.09592, 451322.6748999898, 528485.2937329033, 1041.9286845759661, 47398.28559824328], [801438.0720999994, 17405.88042, 456040.4492710714, 541538.3073750077, 883.2225676353381, 41028.578554656124], [706473.7715999996, 20619.09592, 466189.5999419623, 575619.2748317416, 1041.9286845759661, 47398.28559824328], [669526.4963999996, 18951.570620000002, 470398.7310940031, 587283.6320050729, 842.7612439188044, 39626.748260038796], [600959.1629999997, 15790.806500000002, 480562.9797108553, 620365.2475574827, 761.6495045985062, 36084.6854637884], [555521.9776999999, 21606.952920000003, 482950.2524965611, 624769.5448021124, 1041.9286845759661, 47398.28559824328], [518103.30220000015, 20994.56722, 486414.97408430267, 632797.1454510725, 1038.0008082130785, 47398.28544112822], [526460.1534000002, 3393.77112, 490818.682424441, 645242.8303333434, 281.2352558184508, 12006.215134341739], [484769.64560000016, 3393.77112, 497061.05256181606, 663879.7380663214, 281.2352558184508, 12006.215134341739]], [[3036370.6374999997, 1955642.6032200009, 329899.8818864615, 138135.64307217477, 22837.326652547505, 1553089.038252518], [1607811.9977000002, 1867520.6705600005, 343623.84381165775, 181463.85417123168, 23811.470910046723, 1631703.4856341789], [1357895.8434000001, 1257829.3627600002, 348735.99164693983, 181522.15558040468, 19300.192480674188, 1282542.8704274253], [1240530.9852000002, 804426.06194, 369674.28943118, 248415.60272399426, 14684.3198931083, 953221.0339437546], [1325958.7163000002, 447816.28396000003, 383553.5011646385, 288363.6782075949, 10612.972578053112, 670633.8256843826], [1379709.8304000003, 219264.39338000002, 397594.6431366191, 345228.4353319955, 5476.024841307777, 306612.40261578816], [1344082.2630000005, 92544.69971999999, 407869.83375901624, 382176.3652643907, 2905.4882357884017, 146545.92476747464], [1070028.9183999998, 92544.69971999999, 419496.75562990585, 426041.2606001401, 2905.4882357884017, 146545.92476747464], [1054880.8006999996, 56064.45038, 425272.8345200125, 444044.8911606424, 2281.6856765187954, 112547.81108112569], [902147.7645999992, 67574.81928, 435640.61366248934, 477846.73360206623, 2613.537826209974, 128843.35203740347], [800284.3996999993, 69682.39538, 445159.40416381194, 509876.4250915385, 2655.1081348521006, 131668.88483281853], [849029.6325999993, 19083.13992, 451322.6748999898, 528485.2937329033, 1104.9292672996025, 48098.28811826659], [765509.6648999993, 24937.020620000003, 456088.2936053013, 541715.223971271, 1518.7323139369964, 71470.00374819666], [706473.7715999996, 19083.13992, 466189.5999419623, 575619.2748317416, 1104.9292672996025, 48098.28811826659], [630038.2738999997, 19458.61122, 475801.43980180955, 606411.2550735277, 1101.0013909367149, 48098.28796115152], [594206.9604999996, 20830.34206, 478391.11088319396, 611955.8749086655, 1103.254763156257, 47398.28805128642], [549803.2056, 19458.61122, 482639.317261885, 623372.103149982, 1101.0013909367149, 48098.28796115152], [518754.29400000005, 19083.13992, 486147.48156201374, 631666.674034315, 1104.9292672996025, 48098.28811826659], [524299.5684000002, 3825.88812, 490818.682424441, 645242.8303333434, 357.03140312916526, 15530.272291119138], [480125.52190000017, 5602.8164799999995, 497149.12687904586, 664200.9590337336, 342.36615032379507, 14838.571080947382]], [[1497794.8744999997, 2529571.2766200006, 329899.8818864615, 138135.64307217477, 31465.191065471285, 2169943.023854766], [1246243.7762, 1919879.9688199998, 335025.76225841214, 138135.64307217475, 26953.91263609875, 1820782.4086480122], [1145923.2190000003, 1322695.2143199996, 348735.99164693983, 181522.15558040468, 20380.285381812417, 1339193.0783412782], [1312984.8620000002, 686289.3012799999, 369907.01664463663, 249805.53814451626, 15175.60324573532, 970912.9942586503], [1396908.4265000003, 418027.55762, 384084.49188122683, 307424.9808879553, 9946.274161834097, 594135.9190197336], [1379671.7865000004, 197507.67846000002, 397601.54711754964, 345266.81696088874, 5571.19593666409, 309412.6174237279], [1305674.3437000006, 101818.44442, 407916.6725818949, 382405.1416095237, 3463.8287898014687, 173443.59931369952], [1031620.9990999999, 101818.44442, 419543.5944527845, 426270.03694527305, 3463.8287898014682, 173443.59931369952], [911559.0719999995, 101818.44442, 429814.04233212955, 459601.6059367265, 3463.8287898014687, 173443.59931369952], [899583.0606999992, 63332.8068, 435535.9276399808, 477340.97752355796, 2722.874665174515, 133068.88754347977], [800284.3996999993, 63332.8068, 445292.04222249595, 510515.5330867365, 2722.874665174515, 133068.88754347977], [834741.4657999992, 25371.332680000003, 451187.0628011706, 527948.9125456846, 1345.2549289080364, 58702.461938964276], [743656.7388999994, 33282.47378, 456232.38726961013, 542284.3336129963, 1644.3642668863367, 76420.86003758438], [701903.5541999997, 24035.21954, 465963.2256197797, 574764.357609528, 1155.6110593416324, 53050.337082524566], [588292.4273999999, 31746.517780000002, 476191.90354561387, 608080.5033600455, 1707.3648496099731, 77120.86255760767], [551327.9743999997, 33493.719919999996, 478397.350394441, 611985.306295825, 1705.6903454666276, 76420.86249062752], [561272.3134999997, 16222.923500000003, 483219.1697891246, 626122.6540610244, 837.4456519092206, 39608.742620565805], [518103.30220000015, 19083.13992, 486449.33609462203, 632962.8982914173, 1104.9292672996025, 48098.28811826659], [532830.6109999998, 8695.17368, 486769.3846918382, 630480.3203135988, 501.1519715591697, 21900.471087174752], [470912.76270000014, 8695.17368, 497275.69748277834, 664664.8444675793, 501.1519715591697, 21900.471087174752]], [[1497794.8744999997, 2374121.8567200005, 329899.8818864615, 138135.64307217477, 31854.358458506504, 2171343.0394214615], [998858.4854000002, 1921970.216700001, 343610.1112749892, 181522.15558040468, 28614.676301866144, 1922751.0694812986], [1145923.2190000003, 1238629.68228, 348735.99164693983, 181522.15558040468, 20795.69082161693, 1339893.0949574958], [1221307.5829999999, 699514.9633799997, 370001.77809529187, 250665.18225655233, 16142.100612004004, 1019049.8197064901], [1391481.3995000003, 392914.34986, 384084.49188122683, 307424.9808879553, 10246.787031654541, 597659.9851651798], [1379671.7865000004, 186727.32576000004, 397601.54711754964, 345266.81696088874, 5766.843372561973, 310812.6252496253], [1257008.9539000005, 125500.1832, 407896.27040683536, 382250.60313978733, 3951.4293501033576, 196789.294427037], [995949.2949999998, 119513.38422000002, 419364.1175712218, 425402.1526049421, 3879.650390041953, 192544.2076550567], [911559.0719999995, 99718.44362, 429814.04233212955, 459601.6059367265, 3515.445641245702, 174843.60137837357], [899583.0606999992, 61796.85080000001, 435535.9276399808, 477340.97752355796, 2785.8752478981514, 133768.89006350306], [757405.4135999993, 75996.18466, 445299.3969818727, 510551.0157152744, 3325.3102474848856, 162091.46198282085], [807934.7778999992, 33282.47378, 451377.8739935964, 528697.6929577045, 1644.3642668863367, 76420.86003758438], [731707.2839999995, 40731.03282000001, 456192.97962780995, 542220.9800497793, 1880.040584233086, 84901.33121586994], [663594.7854999995, 31746.517780000002, 466196.1713000282, 575650.4541419229, 1707.3648496099731, 77120.86255760769], [588292.4273999999, 32121.98908, 476157.5415352946, 607914.7505197007, 1703.4369732470855, 77120.86240049262], [550676.9826, 32360.113879999997, 478713.0202531042, 613348.2802967535, 1678.6367333445824, 77820.86140848303], [539079.1407999999, 22035.15706, 483158.29872434627, 625913.580316625, 1225.5887179591332, 55867.149635603506], [539904.1092000001, 9821.61724, 487123.46362981485, 636115.6773545033, 627.1649272404186, 26844.57535673408], [508293.38610000006, 9205.37084, 491033.3776360421, 646028.1088387027, 638.1937089869957, 28944.575797885347], [468662.9974000001, 9127.29068, 497140.6241119994, 664175.2149007457, 576.9481188698842, 25424.52824395215]], [[887206.4182000002, 2584020.8227600013, 329899.8818864615, 138135.64307217477, 36268.3964572907, 2460990.6077018855], [998858.4854000002, 1854409.4610800007, 343610.1112749892, 181522.15558040468, 29026.92337214617, 1924151.0859711815], [1137566.4098000003, 1197977.8787600002, 348735.99164693983, 181522.15558040468, 21119.20036148278, 1345536.925792124], [1221307.5829999999, 670577.8008199997, 370001.77809529187, 250665.18225655233, 16501.779469166504, 1019749.8340936444], [1391481.3995000003, 365700.4823, 384084.49188122683, 307424.9808879553, 10580.426656523021, 599059.9985107648], [1303609.0829000003, 212000.35776, 397594.6431366191, 345228.4353319955, 6516.261352722372, 353286.0010181254], [1218601.0346000006, 134773.9279, 407943.109229714, 382479.37948492036, 4509.769904116425, 223686.96897326192], [959150.1715999997, 128617.03376, 419351.48686905054, 425462.3414262361, 4415.509893428136, 218029.29156998478], [875887.3678999994, 113539.26694, 429732.8414989315, 459207.0767512487, 3943.489044001479, 193944.21020860283], [908310.0627999995, 56488.22182000001, 435351.3444008188, 476630.4339141072, 2818.0914257497852, 135156.16095269812], [907233.4388999993, 30824.15788, 441621.7594110813, 495523.137394526, 1741.6373160682192, 78520.86392850634], [791862.4796999993, 37112.350640000004, 451194.5353825524, 527984.9491125616, 1981.9629776766526, 89125.03774920403], [727358.4486999996, 36489.02034, 456040.4492710714, 541538.3073750077, 1988.1518349349408, 89126.86667292271], [663594.7854999995, 32121.98908, 466161.80928970897, 575484.7013015781, 1703.4369732470855, 77120.86240049262], [588292.4273999999, 30824.15788, 476191.90354561387, 608080.5033600455, 1741.637316068219, 78520.86392850634], [550676.9826, 31746.517780000002, 478713.0202531042, 613348.2802967535, 1707.3648496099731, 77120.86255760769], [540465.9320999999, 21288.20866, 482663.6642557575, 623507.0965792107, 1298.4156560459842, 56560.40051361254], [539704.2455, 8754.20454, 487262.34681535227, 636617.0555766734, 671.5843101850714, 31047.953151043643], [509078.2763000001, 8930.443519999999, 490859.73529361177, 645232.3830322599, 651.0420541519836, 28944.576311819153], [466602.87830000016, 8786.842719999999, 497275.69748277834, 664664.8444675793, 638.1937089869957, 28944.575797885347]], [[887206.4182000002, 2516460.0671400023, 329899.8818864615, 138135.64307217477, 36680.643527570726, 2462390.6241917685], [1057490.9726, 1854152.3431200003, 335138.5569840718, 138135.64307217475, 28645.238469381366, 1870338.253187621], [1045889.1307999998, 1247567.0928599997, 348937.8640095811, 181522.15558040468, 22086.085926499563, 1392973.751255492], [1215880.5559999999, 645464.59306, 370001.77809529187, 250665.18225655233, 16802.292338986947, 1023273.9002390907], [1220364.5630000003, 418197.04954, 383522.2538161113, 288176.3344087267, 11545.850151146815, 674817.5455814032], [1303609.0829000003, 201220.00506000002, 397594.6431366191, 345228.4353319955, 6711.299117030507, 355386.00881963596], [1300149.9693000005, 95968.24754000001, 407916.6725818949, 382405.1416095237, 3752.5144381854843, 182592.28178057753], [1021214.3047999999, 94940.36298, 419543.5944527845, 426270.03694527305, 3912.3834294104695, 188264.09888163852], [939966.8782999995, 87194.90614, 425259.2582420161, 443979.38779960247, 3930.773392121811, 188276.54868189458], [888008.8128999993, 76087.87266000001, 435892.51934385335, 477748.28317915666, 2939.428927946756, 137271.2875514037], [870945.1216999993, 47127.13018000001, 441473.9609295648, 494915.6802959773, 2267.601317763868, 103265.43523720339], [791636.4876999992, 36864.49164000001, 451151.57398473844, 527785.9138793711, 1984.223958572053, 89126.86651580765], [694645.7159999995, 45473.784380000005, 456205.5042083361, 542281.5668407474, 2558.650362440212, 116734.45875697338], [645512.3638999996, 36489.02034, 465963.2256197797, 574764.357609528, 1988.1518349349408, 89126.86667292271], [587159.2877999999, 29905.79036, 475841.96563071705, 606606.1161238935, 1772.1412987414024, 80620.86514866565], [541339.7090999999, 34428.125420000004, 478704.7350720799, 613322.3330411486, 1889.1303538318016, 85582.97448411825], [536191.3817, 22321.03806, 482664.12257401535, 623508.5037401816, 1419.988719082816, 61504.29360448027], [508766.02870000014, 21335.81836, 486439.3210781752, 632932.1388803012, 1298.4156560459842, 56560.40051361254], [506539.4670000002, 9480.26974, 490728.3732897409, 644754.1614078487, 734.319142620091, 32472.009785368446], [466224.65400000016, 8697.019999999999, 497144.8138158391, 664187.7111788975, 672.7999981753347, 31047.953199671167]]]
horizon = "inc"
horizon = "trans"

##############################################################################

def bar_chart(cost_per_, N_START, filename):
    # コストデータを億単位に変換
    cost_per_ = cost_per_ / 1e4
    
    TC_direct = cost_per_[:, 0]
    TC_indirect = cost_per_[:, 1]
    IC_inc = cost_per_[:, 2]
    OC_inc = cost_per_[:, 3]
    IC_trans = cost_per_[:, 4]
    OC_trans = cost_per_[:, 5]

    plt.figure(figsize=(12, 6))
    N_FACILITY = np.arange(cost_per_.shape[0]) + N_START
    plt.xticks(N_FACILITY)
    plt.bar(N_FACILITY, TC_direct, color='blue', label='TC_direct')
    plt.bar(N_FACILITY, TC_indirect, bottom=TC_direct, color='blue', linestyle='--', label='TC_indirect')
    plt.bar(N_FACILITY, IC_inc, bottom=TC_direct + TC_indirect, color='orange', label='IC_inc')
    plt.bar(N_FACILITY, OC_inc, bottom=TC_direct + TC_indirect + IC_inc, color='orange', linestyle='--', label='OC_inc')
    plt.bar(N_FACILITY, IC_trans, bottom=TC_direct + TC_indirect + IC_inc + OC_inc, color='yellow', label='IC_trans')
    plt.bar(N_FACILITY, OC_trans, bottom=TC_direct + TC_indirect + IC_inc + OC_inc + IC_trans, color='yellow', linestyle='--', label='OC_trans')

    # 同色間点線の描画
    for x in range(cost_per_.shape[0]):
        adjusted_x = x + N_START  # 調整されたインデックス
        plt.hlines(TC_direct[x], adjusted_x - 0.4, adjusted_x + 0.4, colors='black', linestyles='dotted')
        plt.hlines(TC_direct[x] + TC_indirect[x] + IC_inc[x], adjusted_x - 0.4, adjusted_x + 0.4, colors='black', linestyles='dotted')
        plt.hlines(TC_direct[x] + TC_indirect[x] + IC_inc[x] + OC_inc[x] + IC_trans[x], adjusted_x - 0.4, adjusted_x + 0.4, colors='black', linestyles='dotted')

    # 凡例
    handles, labels = plt.gca().get_legend_handles_labels()
    # plt.legend(handles[::-1], labels[::-1], loc='upper left', bbox_to_anchor=(1.05, 1))        
    plt.legend(handles[::-1], labels[::-1], loc='lower left', bbox_to_anchor=(1, 0.4))        

    # ラベル
    plt.xlabel(xlabel)
    plt.ylabel('Cost (億円)')
    plt.title(f'Stacked Bar Chart for {title_suffix}')
    plt.tight_layout(rect=[0, 0, 0.85, 1])
    
    # ファイルに保存
    plt.savefig(filename)
    plt.close()  # グラフを閉じる

# グラフを保存するフォルダを作成
save_folder = f"graphs_{str(foldername)}_{current_time}"
if not os.path.exists(save_folder):
    os.makedirs(save_folder)

if horizon == "inc":
    for N_TRANS in range(len(cost)):
        cost_per_inc = np.array(cost[N_TRANS])
        title_suffix = f'N_TRANS = {N_TRANS}'
        xlabel = 'N_INC'
        filename = os.path.join(save_folder, f'TRANS{N_TRANS}.png')
        bar_chart(cost_per_inc, 1, filename)

if horizon == "trans":
    transposed_cost = np.transpose(cost, (1, 0, 2))
    for N_INC in range(len(transposed_cost)):
        cost_per_trans = np.array(transposed_cost[N_INC])
        title_suffix = f'N_INC = {N_INC+1}'
        xlabel = 'N_TRANS'
        filename = os.path.join(save_folder, f'INC{N_INC+1}.png')
        bar_chart(cost_per_trans, 0, filename)
